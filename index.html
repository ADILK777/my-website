<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAVALIGHT | Professional Valorant Esports Team</title>
    
    <!-- EmailJS Script -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Exo+2:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ... (ALL EXISTING CSS STYLES REMAIN THE SAME) ... */
        /* All your existing CSS is preserved */
        
        /* ============================================
           TEAM PORTAL & ADMIN PANEL FIXES
        ============================================ */
        .team-portal.active,
        .admin-panel.active {
            display: block !important;
        }
        
        /* ============================================
           DASHBOARD ACTION BUTTONS
        ============================================ */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .edit-btn {
            background: #4CAF50;
            color: white;
        }
        
        .delete-btn {
            background: #f44336;
            color: white;
        }
        
        .view-btn {
            background: #2196F3;
            color: white;
        }
        
        /* ============================================
           EMPTY STATE MESSAGES
        ============================================ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #a0b0ff;
            font-size: 1.2rem;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #00ccff;
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="loader"></div>
        <div class="loader-text">CAVALIGHT VALORANT</div>
    </div>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="container navbar-container">
            <div class="logo">
                <div class="logo-icon">C</div>
                <div class="logo-text">CAVALIGHT</div>
            </div>
            
            <ul class="nav-menu" id="navMenu">
                <li class="nav-item"><a href="#home" class="nav-link active">Home</a></li>
                <li class="nav-item"><a href="#about" class="nav-link">About</a></li>
                <li class="nav-item"><a href="#roster" class="nav-link">Roster</a></li>
                <li class="nav-item"><a href="#media" class="nav-link">Media</a></li>
                <li class="nav-item"><a href="#events" class="nav-link">Events</a></li>
                <li class="nav-item"><a href="#news" class="nav-link">News</a></li>
                <li class="nav-item"><a href="#community" class="nav-link">Community</a></li>
                <li class="nav-item"><a href="#contact" class="nav-link">Contact</a></li>
                
                <!-- Dynamic menu items based on role -->
                <li class="nav-item" id="teamPortalItem" style="display: none;">
                    <a href="#" class="nav-link" onclick="showSection('team-portal')">Team Portal</a>
                </li>
                <li class="nav-item" id="adminPanelItem" style="display: none;">
                    <a href="#" class="nav-link" onclick="showSection('admin-panel')">Admin Panel</a>
                </li>
                <li class="nav-item" id="dashboardItem" style="display: none;">
                    <a href="#" class="nav-link" onclick="showDashboard()">Dashboard</a>
                </li>
                
                <div class="nav-cta">
                    <div id="userRoleBadge" style="display: none;"></div>
                    <a href="#" class="btn btn-outline" onclick="openModal('registerModal')" id="registerBtn">Register</a>
                    <a href="#" class="btn btn-primary" onclick="openModal('loginModal')" id="loginBtn">Sign In</a>
                </div>
            </ul>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Main Website Content -->
    <div id="main-website">
        <!-- All existing sections remain the same -->
        <!-- ... -->
        
        <!-- Team Portal Section (Visible only to Team Members) -->
        <section class="team-portal section-padding" id="team-portal">
            <div class="team-portal-bg"></div>
            <div class="container">
                <h2 class="section-title">TEAM PORTAL</h2>
                <p class="section-subtitle">
                    Private area for CAVALIGHT team members
                </p>
                
                <div class="portal-grid">
                    <div class="portal-card">
                        <div class="portal-icon"><i class="fas fa-chart-bar"></i></div>
                        <h3 class="portal-title">Scrim Results</h3>
                        <p class="portal-description">Upload and review scrim results and analytics</p>
                        <div class="action-buttons">
                            <button class="btn btn-success action-btn" onclick="openScrimUploadModal()">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                            <button class="btn btn-outline action-btn" onclick="viewScrimResults()">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </div>
                    </div>
                    
                    <div class="portal-card">
                        <div class="portal-icon"><i class="fas fa-video"></i></div>
                        <h3 class="portal-title">Strategy Videos</h3>
                        <p class="portal-description">Access and upload team strategy videos</p>
                        <div class="action-buttons">
                            <button class="btn btn-success action-btn" onclick="openStrategyModal()">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                            <button class="btn btn-outline action-btn" onclick="viewStrategies()">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </div>
                    </div>
                    
                    <div class="portal-card">
                        <div class="portal-icon"><i class="fas fa-dumbbell"></i></div>
                        <h3 class="portal-title">Training Plans</h3>
                        <p class="portal-description">View and manage team training schedules</p>
                        <div class="action-buttons">
                            <button class="btn btn-success action-btn" onclick="openTrainingModal()">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-outline action-btn" onclick="viewTraining()">
                                <i class="fas fa-calendar"></i> Schedule
                            </button>
                        </div>
                    </div>
                    
                    <div class="portal-card">
                        <div class="portal-icon"><i class="fas fa-calendar-alt"></i></div>
                        <h3 class="portal-title">Upcoming Matches</h3>
                        <p class="portal-description">View tournament schedules and match details</p>
                        <div class="action-buttons">
                            <button class="btn btn-success action-btn" onclick="viewMatches()">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-outline action-btn" onclick="addMatch()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    
                    <div class="portal-card">
                        <div class="portal-icon"><i class="fas fa-comments"></i></div>
                        <h3 class="portal-title">Team Chat</h3>
                        <p class="portal-description">Access private team communication channels</p>
                        <div class="action-buttons">
                            <button class="btn btn-success action-btn" onclick="openTeamChat()">
                                <i class="fas fa-comments"></i> Open Chat
                            </button>
                        </div>
                    </div>
                    
                    <div class="portal-card">
                        <div class="portal-icon"><i class="fas fa-file-alt"></i></div>
                        <h3 class="portal-title">Team Posts</h3>
                        <p class="portal-description">Create and view team-only posts and updates</p>
                        <div class="action-buttons">
                            <button class="btn btn-success action-btn" onclick="createTeamPost()">
                                <i class="fas fa-plus"></i> Create
                            </button>
                            <button class="btn btn-outline action-btn" onclick="viewTeamPosts()">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Panel Section (Visible only to Administrators) -->
        <section class="admin-panel section-padding" id="admin-panel">
            <div class="admin-panel-bg"></div>
            <div class="container">
                <h2 class="section-title">ADMIN PANEL</h2>
                <p class="section-subtitle">
                    Full control panel for CAVALIGHT administrators
                </p>
                
                <div class="admin-grid">
                    <div class="admin-card">
                        <div class="admin-icon"><i class="fas fa-users-cog"></i></div>
                        <h3 class="admin-title">User Management</h3>
                        <p class="admin-description">Manage all user accounts, roles, and permissions</p>
                        <div class="action-buttons">
                            <button class="btn btn-danger action-btn" onclick="showDashboardSection('users')">
                                <i class="fas fa-users"></i> Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-icon"><i class="fas fa-file-signature"></i></div>
                        <h3 class="admin-title">Applications</h3>
                        <p class="admin-description">Review and process new player applications</p>
                        <div class="action-buttons">
                            <button class="btn btn-danger action-btn" onclick="showDashboardSection('applications')">
                                <i class="fas fa-file"></i> Review
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-icon"><i class="fas fa-folder-open"></i></div>
                        <h3 class="admin-title">Content Management</h3>
                        <p class="admin-description">Approve and manage all uploaded content</p>
                        <div class="action-buttons">
                            <button class="btn btn-danger action-btn" onclick="showDashboardSection('content')">
                                <i class="fas fa-folder"></i> Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-icon"><i class="fas fa-newspaper"></i></div>
                        <h3 class="admin-title">News & Events</h3>
                        <p class="admin-description">Create and edit news articles and events</p>
                        <div class="action-buttons">
                            <button class="btn btn-danger action-btn" onclick="showDashboardSection('news')">
                                <i class="fas fa-edit"></i> Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-icon"><i class="fas fa-user-edit"></i></div>
                        <h3 class="admin-title">Roster Management</h3>
                        <p class="admin-description">Edit team roster and player information</p>
                        <div class="action-buttons">
                            <button class="btn btn-danger action-btn" onclick="showDashboardSection('roster')">
                                <i class="fas fa-users"></i> Edit
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div class="admin-icon"><i class="fas fa-chart-line"></i></div>
                        <h3 class="admin-title">Analytics</h3>
                        <p class="admin-description">View team statistics and growth analytics</p>
                        <div class="action-buttons">
                            <button class="btn btn-danger action-btn" onclick="showDashboardSection('analytics')">
                                <i class="fas fa-chart-bar"></i> View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section class="contact section-padding" id="contact">
            <div class="contact-bg"></div>
            <div class="container">
                <h2 class="section-title">CONTACT US</h2>
                <p class="section-subtitle">
                    Get in touch for partnerships, inquiries, or just to say hello
                </p>
                
                <div class="contact-form">
                    <form id="contactForm">
                        <div class="form-group">
                            <label for="name" class="form-label">Full Name</label>
                            <input type="text" id="name" name="name" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" id="email" name="email" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="subject" class="form-label">Subject</label>
                            <select id="subject" name="subject" class="form-select" required>
                                <option value="">Select a subject</option>
                                <option value="partnership">Partnership</option>
                                <option value="tryout">Team Tryout</option>
                                <option value="general">General Inquiry</option>
                                <option value="support">Technical Support</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="message" class="form-label">Message</label>
                            <textarea id="message" name="message" class="form-textarea" required></textarea>
                        </div>
                        
                        <button type="button" onclick="sendEmail()" class="btn btn-primary form-submit">
                            <i class="fas fa-paper-plane"></i> SEND MESSAGE
                        </button>
                        <div id="form-message"></div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-col">
                        <h3 class="footer-col-title">CAVALIGHT</h3>
                        <p style="color: #a0b0ff; margin-bottom: 20px;">
                            From competitive Valorant team to a thriving gaming community. 
                            Join us as we continue our journey together in the world of professional esports.
                        </p>
                        
                        <div class="footer-social">
                            <!-- UPDATED DISCORD LINK -->
                            <a href="https://discord.gg/Um8VR8yk" target="_blank" class="social-icon">
                                <i class="fab fa-discord"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-twitch"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-youtube"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-instagram"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- ... rest of footer remains the same ... -->
                </div>
            </div>
        </footer>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="dashboard-header">
            <div class="container">
                <h1 style="color: #00ccff; font-size: 2.5rem;">CAVALIGHT DASHBOARD</h1>
                <p style="color: #a0b0ff;">Manage your team, content, and community from one place</p>
            </div>
        </div>
        
        <div class="dashboard-content">
            <div class="dashboard-sidebar">
                <ul class="sidebar-nav">
                    <li><a href="#" class="active" onclick="showDashboardSection('overview')"><i class="fas fa-tachometer-alt"></i> Overview</a></li>
                    <li><a href="#" onclick="showDashboardSection('users')"><i class="fas fa-users"></i> User Management</a></li>
                    <li><a href="#" onclick="showDashboardSection('applications')"><i class="fas fa-file-signature"></i> Applications</a></li>
                    <li><a href="#" onclick="showDashboardSection('content')"><i class="fas fa-folder-open"></i> Content</a></li>
                    <li><a href="#" onclick="showDashboardSection('media')"><i class="fas fa-video"></i> Media</a></li>
                    <li><a href="#" onclick="showDashboardSection('events')"><i class="fas fa-calendar-alt"></i> Events</a></li>
                    <li><a href="#" onclick="showDashboardSection('news')"><i class="fas fa-newspaper"></i> News</a></li>
                    <li><a href="#" onclick="showDashboardSection('roster')"><i class="fas fa-user-edit"></i> Roster</a></li>
                    <li><a href="#" onclick="showDashboardSection('analytics')"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                    <li><a href="#" onclick="showDashboardSection('settings')"><i class="fas fa-cog"></i> Settings</a></li>
                    <li><a href="#" onclick="hideDashboard()"><i class="fas fa-arrow-left"></i> Back to Website</a></li>
                </ul>
            </div>
            
            <div class="dashboard-main">
                <!-- Overview Section -->
                <div id="overview-section" class="dashboard-section active">
                    <h2>Dashboard Overview</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <i class="fas fa-users"></i>
                            <h3 id="totalUsers">0</h3>
                            <p>Community Members</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-calendar-check"></i>
                            <h3 id="totalEvents">0</h3>
                            <p>Upcoming Events</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-video"></i>
                            <h3 id="totalMedia">0</h3>
                            <p>Media Uploads</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-chart-line"></i>
                            <h3>+12%</h3>
                            <p>Growth This Month</p>
                        </div>
                    </div>
                    
                    <h3>Recent Activity</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Action</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivity">
                            <!-- Will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- User Management Section -->
                <div id="users-section" class="dashboard-section">
                    <h2>User Management</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <i class="fas fa-user-friends"></i>
                            <h3 id="teamMembers">0</h3>
                            <p>Team Members</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-user-shield"></i>
                            <h3 id="adminCount">0</h3>
                            <p>Administrators</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-user-clock"></i>
                            <h3 id="pendingApps">0</h3>
                            <p>Pending Applications</p>
                        </div>
                    </div>
                    
                    <h3>User List</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openUserModal()">
                            <i class="fas fa-plus"></i> Add New User
                        </button>
                        <button class="btn btn-secondary" onclick="refreshUsers()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Join Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="userList">
                            <!-- Users will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Media Management Section -->
                <div id="media-section" class="dashboard-section">
                    <h2>Media Management</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <i class="fas fa-video"></i>
                            <h3 id="totalClips">0</h3>
                            <p>Clips</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-eye"></i>
                            <h3 id="totalViews">0</h3>
                            <p>Total Views</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-thumbs-up"></i>
                            <h3 id="totalLikes">0</h3>
                            <p>Likes</p>
                        </div>
                    </div>
                    
                    <h3>Media List</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openUploadModal()">
                            <i class="fas fa-upload"></i> Upload New Media
                        </button>
                        <button class="btn btn-secondary" onclick="refreshMedia()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Uploader</th>
                                <th>Date</th>
                                <th>Views</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="mediaList">
                            <!-- Media will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Events Management Section -->
                <div id="events-section" class="dashboard-section">
                    <h2>Event Management</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <i class="fas fa-calendar"></i>
                            <h3 id="upcomingEvents">0</h3>
                            <p>Upcoming Events</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-users"></i>
                            <h3 id="totalParticipants">0</h3>
                            <p>Total Participants</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-check-circle"></i>
                            <h3 id="completedEvents">0</h3>
                            <p>Completed Events</p>
                        </div>
                    </div>
                    
                    <h3>Event List</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openCreateEventModal()">
                            <i class="fas fa-plus"></i> Create New Event
                        </button>
                        <button class="btn btn-secondary" onclick="refreshEvents()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Participants</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="eventList">
                            <!-- Events will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- News Management Section -->
                <div id="news-section" class="dashboard-section">
                    <h2>News Management</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <i class="fas fa-newspaper"></i>
                            <h3 id="totalNews">0</h3>
                            <p>News Posts</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-eye"></i>
                            <h3 id="newsViews">0</h3>
                            <p>Total Views</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-comments"></i>
                            <h3 id="newsComments">0</h3>
                            <p>Comments</p>
                        </div>
                    </div>
                    
                    <h3>News List</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openNewsModal()">
                            <i class="fas fa-plus"></i> Create News Post
                        </button>
                        <button class="btn btn-secondary" onclick="refreshNews()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Author</th>
                                <th>Status</th>
                                <th>Views</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="newsList">
                            <!-- News will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Other sections remain -->
                <div id="applications-section" class="dashboard-section">
                    <h2>Applications Management</h2>
                    <div class="empty-state">
                        <i class="fas fa-file-signature"></i>
                        <h3>No Applications Yet</h3>
                        <p>When players apply to join the team, their applications will appear here.</p>
                    </div>
                </div>
                
                <div id="content-section" class="dashboard-section">
                    <h2>Content Management</h2>
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>Content Management</h3>
                        <p>Manage all website content from this section.</p>
                    </div>
                </div>
                
                <div id="roster-section" class="dashboard-section">
                    <h2>Roster Management</h2>
                    <div class="empty-state">
                        <i class="fas fa-user-edit"></i>
                        <h3>Roster Management</h3>
                        <p>Edit team roster and player information here.</p>
                    </div>
                </div>
                
                <div id="analytics-section" class="dashboard-section">
                    <h2>Analytics</h2>
                    <div class="empty-state">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Analytics Dashboard</h3>
                        <p>View website and community analytics here.</p>
                    </div>
                </div>
                
                <div id="settings-section" class="dashboard-section">
                    <h2>Settings</h2>
                    <div class="empty-state">
                        <i class="fas fa-cog"></i>
                        <h3>Settings</h3>
                        <p>Configure website settings here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- All existing modals remain -->
    <!-- ... -->

    <!-- Edit Event Modal -->
    <div id="editEventModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('editEventModal')">&times;</button>
            <h3 style="margin-bottom: 1.5rem; text-align: center; color: #00ccff;">EDIT EVENT</h3>
            <form id="editEventForm">
                <input type="hidden" id="editEventId">
                <div class="form-group">
                    <label class="form-label">Event Title</label>
                    <input type="text" id="editEventTitle" class="form-input" placeholder="Enter event title" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="editEventDescription" class="form-textarea" placeholder="Describe the event" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="datetime-local" id="editEventDate" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Event Type</label>
                    <select id="editEventType" class="form-select" required>
                        <option value="">Select type</option>
                        <option value="tournament">Tournament</option>
                        <option value="scrim">Scrim</option>
                        <option value="community">Community Event</option>
                        <option value="training">Training</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Location/Platform</label>
                    <input type="text" id="editEventLocation" class="form-input" placeholder="e.g., Discord, Twitch, In-person" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Max Participants</label>
                    <input type="number" id="editEventParticipants" class="form-input" placeholder="Maximum number of participants" min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="editEventStatus" class="form-select" required>
                        <option value="upcoming">Upcoming</option>
                        <option value="ongoing">Ongoing</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <button type="button" onclick="updateEvent()" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">UPDATE EVENT</button>
                <button type="button" onclick="deleteCurrentEvent()" class="btn btn-danger" style="width: 100%;">DELETE EVENT</button>
            </form>
        </div>
    </div>

    <!-- Edit Media Modal -->
    <div id="editMediaModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('editMediaModal')">&times;</button>
            <h3 style="margin-bottom: 1.5rem; text-align: center; color: #00ccff;">EDIT MEDIA</h3>
            <form id="editMediaForm">
                <input type="hidden" id="editMediaId">
                <div class="form-group">
                    <label class="form-label">Clip Title</label>
                    <input type="text" id="editMediaTitle" class="form-input" placeholder="Enter clip title" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="editMediaDescription" class="form-textarea" placeholder="Describe your clip" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select id="editMediaCategory" class="form-select" required>
                        <option value="">Select category</option>
                        <option value="highlights">Highlights</option>
                        <option value="tournaments">Tournaments</option>
                        <option value="community">Community</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Video URL</label>
                    <input type="url" id="editMediaUrl" class="form-input" placeholder="Paste video URL (YouTube, Twitch, etc.)" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Thumbnail URL</label>
                    <input type="url" id="editMediaThumbnail" class="form-input" placeholder="Paste thumbnail image URL">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="editMediaStatus" class="form-select" required>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <button type="button" onclick="updateMedia()" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">UPDATE MEDIA</button>
                <button type="button" onclick="deleteCurrentMedia()" class="btn btn-danger" style="width: 100%;">DELETE MEDIA</button>
            </form>
        </div>
    </div>

    <!-- Edit News Modal -->
    <div id="editNewsModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('editNewsModal')">&times;</button>
            <h3 style="margin-bottom: 1.5rem; text-align: center; color: #00ccff;">EDIT NEWS</h3>
            <form id="editNewsForm">
                <input type="hidden" id="editNewsId">
                <div class="form-group">
                    <label class="form-label">News Title</label>
                    <input type="text" id="editNewsTitle" class="form-input" placeholder="Enter news title" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Content</label>
                    <textarea id="editNewsContent" class="form-textarea" placeholder="Write your news article" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select id="editNewsCategory" class="form-select" required>
                        <option value="">Select category</option>
                        <option value="announcement">Announcement</option>
                        <option value="tournament">Tournament Result</option>
                        <option value="team">Team Update</option>
                        <option value="community">Community News</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Image URL</label>
                    <input type="url" id="editNewsImage" class="form-input" placeholder="Paste image URL">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="editNewsStatus" class="form-select" required>
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>
                <button type="button" onclick="updateNews()" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">UPDATE NEWS</button>
                <button type="button" onclick="deleteCurrentNews()" class="btn btn-danger" style="width: 100%;">DELETE NEWS</button>
            </form>
        </div>
    </div>

    <script>
        // Initialize EmailJS with updated Public Key
        (function() {
            emailjs.init("gO4Y8T0cZIAi1GZT_");
        })();

        // =============================================
        // ACCESS CODES
        // =============================================
        const TEAM_MEMBER_CODE = "8215";
        const ADMIN_CODE = "CAV-ADMIN-9999";

        // ============================================
        // PRELOADER
        // ============================================
        window.addEventListener('load', function() {
            const preloader = document.getElementById('preloader');
            setTimeout(() => {
                preloader.style.opacity = '0';
                preloader.style.visibility = 'hidden';
            }, 1000);
            
            // Initialize data
            checkCounters();
            loadInitialData();
            checkLoggedInUser();
            updateDashboardStats();
        });

        // ============================================
        // NAVIGATION
        // ============================================
        const navbar = document.getElementById('navbar');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navMenu = document.getElementById('navMenu');
        const navLinks = document.querySelectorAll('.nav-link');

        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            if (window.scrollY > 100) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
            
            // Back to top button
            const backToTop = document.getElementById('backToTop');
            if (window.scrollY > 500) {
                backToTop.classList.add('active');
            } else {
                backToTop.classList.remove('active');
            }
        });

        // Mobile menu toggle
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', function() {
                navMenu.classList.toggle('active');
                mobileMenuBtn.innerHTML = navMenu.classList.contains('active') 
                    ? '<i class="fas fa-times"></i>' 
                    : '<i class="fas fa-bars"></i>';
            });
        }

        // Close mobile menu when clicking a link
        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (this.getAttribute('href') !== '#') {
                    navMenu.classList.remove('active');
                    if (mobileMenuBtn) {
                        mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
                    }
                }
            });
        });

        // ============================================
        // ANIMATED COUNTERS
        // ============================================
        function animateCounter(element) {
            const target = parseInt(element.getAttribute('data-count'));
            const current = parseInt(element.textContent);
            const increment = target / 50;
            
            if (current < target) {
                element.textContent = Math.floor(current + increment);
                setTimeout(() => animateCounter(element), 20);
            } else {
                element.textContent = target;
            }
        }

        function checkCounters() {
            const counters = document.querySelectorAll('[data-count]');
            
            counters.forEach(counter => {
                const position = counter.getBoundingClientRect().top;
                const screenPosition = window.innerHeight / 1.3;
                
                if (position < screenPosition && counter.textContent === '0') {
                    animateCounter(counter);
                }
            });
        }

        window.addEventListener('scroll', checkCounters);

        // ============================================
        // BACK TO TOP BUTTON
        // ============================================
        const backToTop = document.getElementById('backToTop');
        if (backToTop) {
            backToTop.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        // ============================================
        // SMOOTH SCROLLING
        // ============================================
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') return;
                
                e.preventDefault();
                const targetId = this.getAttribute('href');
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // ============================================
        // SECTION NAVIGATION
        // ============================================
        function showSection(sectionId) {
            // Hide all special sections
            document.querySelectorAll('.team-portal, .admin-panel').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
                section.style.display = 'block';
                
                // Scroll to section
                window.scrollTo({
                    top: section.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        }

        // =============================================
        // MODAL FUNCTIONS
        // =============================================
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                // Clear form fields
                const inputs = modal.querySelectorAll('input, textarea, select');
                inputs.forEach(input => {
                    if (input.type !== 'submit' && input.type !== 'button') {
                        input.value = '';
                    }
                });
            }
        }

        function switchToRegister() {
            closeModal('loginModal');
            openModal('registerModal');
        }

        function switchToLogin() {
            closeModal('registerModal');
            openModal('loginModal');
        }

        // Modal opening functions
        function openUploadModal() {
            openModal('uploadMediaModal');
        }

        function openCreateEventModal() {
            openModal('createEventModal');
        }

        function openEditEventModal(eventId) {
            const events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
            const event = events.find(e => e.id == eventId);
            
            if (event) {
                document.getElementById('editEventId').value = event.id;
                document.getElementById('editEventTitle').value = event.title;
                document.getElementById('editEventDescription').value = event.description;
                document.getElementById('editEventDate').value = event.date;
                document.getElementById('editEventType').value = event.type;
                document.getElementById('editEventLocation').value = event.location;
                document.getElementById('editEventParticipants').value = event.maxParticipants || 0;
                document.getElementById('editEventStatus').value = event.status || 'upcoming';
                
                openModal('editEventModal');
            }
        }

        function openEditMediaModal(mediaId) {
            const mediaItems = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
            const media = mediaItems.find(m => m.id == mediaId);
            
            if (media) {
                document.getElementById('editMediaId').value = media.id;
                document.getElementById('editMediaTitle').value = media.title;
                document.getElementById('editMediaDescription').value = media.description;
                document.getElementById('editMediaCategory').value = media.category;
                document.getElementById('editMediaUrl').value = media.url;
                document.getElementById('editMediaThumbnail').value = media.thumbnail || '';
                document.getElementById('editMediaStatus').value = media.status || 'pending';
                
                openModal('editMediaModal');
            }
        }

        function openEditNewsModal(newsId) {
            const newsItems = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
            const news = newsItems.find(n => n.id == newsId);
            
            if (news) {
                document.getElementById('editNewsId').value = news.id;
                document.getElementById('editNewsTitle').value = news.title;
                document.getElementById('editNewsContent').value = news.content;
                document.getElementById('editNewsCategory').value = news.category;
                document.getElementById('editNewsImage').value = news.image || '';
                document.getElementById('editNewsStatus').value = news.status || 'published';
                
                openModal('editNewsModal');
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // =============================================
        // CHECK LOGGED IN USER
        // =============================================
        function checkLoggedInUser() {
            const userData = localStorage.getItem('cavalight_currentUser');
            const userRole = localStorage.getItem('cavalight_userRole');
            
            if (userData && userRole) {
                try {
                    const user = JSON.parse(userData);
                    updateUIForRole(userRole, user.username);
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
        }

        // =============================================
        // AUTHENTICATION FUNCTIONS
        // =============================================
        function registerUser() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const accessCode = document.getElementById('regAccessCode').value;

            // Validation
            if (!username || !email || !password || !confirmPassword) {
                alert('Please fill in all required fields!');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long!');
                return;
            }

            // Check if user already exists
            const existingUsers = JSON.parse(localStorage.getItem('cavalight_users') || '[]');
            const userExists = existingUsers.some(user => user.email === email);
            
            if (userExists) {
                alert('This email is already registered. Please use a different email or sign in.');
                return;
            }

            // Determine role
            let role = 'community';
            if (accessCode === TEAM_MEMBER_CODE) {
                role = 'team';
            } else if (accessCode === ADMIN_CODE) {
                role = 'admin';
            } else if (accessCode && accessCode !== '') {
                alert('Invalid access code. Registered as Community Member.');
            }

            // Create user object
            const userData = {
                id: Date.now().toString(),
                username: username,
                email: email,
                password: btoa(password),
                role: role,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };

            // Save user to localStorage
            existingUsers.push(userData);
            localStorage.setItem('cavalight_users', JSON.stringify(existingUsers));
            
            // Save current user data
            localStorage.setItem('cavalight_currentUser', JSON.stringify({
                id: userData.id,
                username: username,
                email: email,
                role: role
            }));
            localStorage.setItem('cavalight_userRole', role);

            // Update UI
            updateUIForRole(role, username);
            
            alert(` Welcome to CAVALIGHT, ${username}!`);
            closeModal('registerModal');
        }

        function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Please fill in all fields!');
                return;
            }

            // Get users from localStorage
            const existingUsers = JSON.parse(localStorage.getItem('cavalight_users') || '[]');
            const user = existingUsers.find(user => user.email === email);

            if (!user) {
                alert('No account found with this email. Please register first.');
                return;
            }

            // Check password
            if (btoa(password) !== user.password) {
                alert('Incorrect password. Please try again.');
                return;
            }

            // Update last login
            user.lastLogin = new Date().toISOString();
            localStorage.setItem('cavalight_users', JSON.stringify(existingUsers));

            // Save current user data
            localStorage.setItem('cavalight_currentUser', JSON.stringify({
                id: user.id,
                username: user.username,
                email: user.email,
                role: user.role
            }));
            localStorage.setItem('cavalight_userRole', user.role);

            // Update UI
            updateUIForRole(user.role, user.username);
            
            alert(` Welcome back, ${user.username}!`);
            closeModal('loginModal');
        }

        function logoutUser() {
            if (confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('cavalight_currentUser');
                localStorage.removeItem('cavalight_userRole');
                alert('Logged out successfully!');
                resetUI();
                window.location.href = '#home';
            }
            return false;
        }

        // =============================================
        // UI MANAGEMENT FUNCTIONS
        // =============================================
        function updateUIForRole(role, username) {
            console.log('Updating UI for:', username, 'Role:', role);
            
            // Get UI elements
            const registerBtn = document.getElementById('registerBtn');
            const loginBtn = document.getElementById('loginBtn');
            const userRoleBadge = document.getElementById('userRoleBadge');
            const teamPortalItem = document.getElementById('teamPortalItem');
            const adminPanelItem = document.getElementById('adminPanelItem');
            const dashboardItem = document.getElementById('dashboardItem');
            const uploadClipBtn = document.getElementById('uploadClipBtn');
            const createEventBtn = document.getElementById('createEventBtn');
            const createNewsBtn = document.getElementById('createNewsBtn');

            // Update navigation buttons
            if (registerBtn && loginBtn) {
                registerBtn.textContent = username.toUpperCase();
                registerBtn.onclick = () => false;
                registerBtn.style.cursor = 'default';
                
                loginBtn.textContent = 'LOGOUT';
                loginBtn.onclick = logoutUser;
            }

            // Update role badge
            if (userRoleBadge) {
                userRoleBadge.style.display = 'block';
                userRoleBadge.textContent = getRoleDisplayName(role);
                userRoleBadge.className = 'role-badge ' + 
                    (role === 'team' ? 'role-team' : 
                     role === 'admin' ? 'role-admin' : 'role-community');
            }

            // Show/hide elements based on role
            const isLoggedIn = true;
            const isTeam = role === 'team' || role === 'admin';
            const isAdmin = role === 'admin';

            // Navigation items
            if (teamPortalItem) teamPortalItem.style.display = isTeam ? 'block' : 'none';
            if (adminPanelItem) adminPanelItem.style.display = isAdmin ? 'block' : 'none';
            if (dashboardItem) dashboardItem.style.display = isTeam ? 'block' : 'none';
            
            // Buttons
            if (uploadClipBtn) uploadClipBtn.style.display = isLoggedIn ? 'block' : 'none';
            if (createEventBtn) createEventBtn.style.display = isAdmin ? 'block' : 'none';
            if (createNewsBtn) createNewsBtn.style.display = isAdmin ? 'block' : 'none';
            
            // Load dashboard data if admin
            if (isAdmin) {
                loadUsers();
                loadDashboardMedia();
                loadDashboardEvents();
                loadDashboardNews();
                updateDashboardStats();
            }
        }

        function getRoleDisplayName(role) {
            switch(role) {
                case 'team': return 'TEAM MEMBER';
                case 'admin': return 'ADMINISTRATOR';
                default: return 'COMMUNITY MEMBER';
            }
        }

        function resetUI() {
            const registerBtn = document.getElementById('registerBtn');
            const loginBtn = document.getElementById('loginBtn');
            const userRoleBadge = document.getElementById('userRoleBadge');
            
            if (registerBtn && loginBtn) {
                registerBtn.textContent = 'REGISTER';
                registerBtn.onclick = () => openModal('registerModal');
                registerBtn.style.cursor = 'pointer';
                
                loginBtn.textContent = 'SIGN IN';
                loginBtn.onclick = () => openModal('loginModal');
            }
            
            if (userRoleBadge) {
                userRoleBadge.style.display = 'none';
            }
            
            // Hide role-specific sections
            const teamPortalItem = document.getElementById('teamPortalItem');
            const adminPanelItem = document.getElementById('adminPanelItem');
            const dashboardItem = document.getElementById('dashboardItem');
            const uploadClipBtn = document.getElementById('uploadClipBtn');
            const createEventBtn = document.getElementById('createEventBtn');
            const createNewsBtn = document.getElementById('createNewsBtn');
            
            if (teamPortalItem) teamPortalItem.style.display = 'none';
            if (adminPanelItem) adminPanelItem.style.display = 'none';
            if (dashboardItem) dashboardItem.style.display = 'none';
            if (uploadClipBtn) uploadClipBtn.style.display = 'none';
            if (createEventBtn) createEventBtn.style.display = 'none';
            if (createNewsBtn) createNewsBtn.style.display = 'none';
            
            // Hide team portal and admin panel
            document.querySelectorAll('.team-portal, .admin-panel').forEach(section => {
                section.style.display = 'none';
                section.classList.remove('active');
            });
        }

        // =============================================
        // DASHBOARD FUNCTIONS
        // =============================================
        function showDashboard() {
            document.getElementById('main-website').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Load all dashboard data
            updateDashboardStats();
            loadUsers();
            loadDashboardMedia();
            loadDashboardEvents();
            loadDashboardNews();
            loadRecentActivity();
            
            return false;
        }

        function hideDashboard() {
            document.getElementById('main-website').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
        }

        function showDashboardSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const section = document.getElementById(sectionId + '-section');
            if (section) {
                section.classList.add('active');
            }
            
            // Update active nav link
            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and activate the clicked link
            const clickedLink = event.target.closest('a');
            if (clickedLink) {
                clickedLink.classList.add('active');
            }
            
            return false;
        }

        // =============================================
        // DASHBOARD STATISTICS
        // =============================================
        function updateDashboardStats() {
            const users = JSON.parse(localStorage.getItem('cavalight_users') || '[]');
            const events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
            const media = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
            const news = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
            
            // Update overview stats
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalEvents').textContent = events.length;
            document.getElementById('totalMedia').textContent = media.length;
            
            // Update user stats
            const teamMembers = users.filter(u => u.role === 'team' || u.role === 'admin').length;
            const admins = users.filter(u => u.role === 'admin').length;
            document.getElementById('teamMembers').textContent = teamMembers;
            document.getElementById('adminCount').textContent = admins;
            
            // Update media stats
            const totalViews = media.reduce((sum, item) => sum + (item.views || 0), 0);
            const totalLikes = media.reduce((sum, item) => sum + (item.likes || 0), 0);
            document.getElementById('totalClips').textContent = media.length;
            document.getElementById('totalViews').textContent = totalViews.toLocaleString();
            document.getElementById('totalLikes').textContent = totalLikes.toLocaleString();
            
            // Update event stats
            const upcomingEvents = events.filter(e => e.status === 'upcoming' || !e.status).length;
            const completedEvents = events.filter(e => e.status === 'completed').length;
            const totalParticipants = events.reduce((sum, event) => sum + (event.participants || 0), 0);
            document.getElementById('upcomingEvents').textContent = upcomingEvents;
            document.getElementById('completedEvents').textContent = completedEvents;
            document.getElementById('totalParticipants').textContent = totalParticipants.toLocaleString();
            
            // Update news stats
            document.getElementById('totalNews').textContent = news.length;
        }

        function loadRecentActivity() {
            const activities = [];
            const users = JSON.parse(localStorage.getItem('cavalight_users') || '[]');
            const events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
            const media = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
            const news = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
            
            // Add user activities
            users.forEach(user => {
                activities.push({
                    user: user.username,
                    action: 'Joined CAVALIGHT',
                    time: new Date(user.createdAt).toLocaleDateString()
                });
            });
            
            // Add event activities
            events.forEach(event => {
                activities.push({
                    user: event.createdBy || 'Admin',
                    action: `Created event: ${event.title}`,
                    time: new Date(event.date).toLocaleDateString()
                });
            });
            
            // Add media activities
            media.forEach(media => {
                activities.push({
                    user: media.uploader || 'Anonymous',
                    action: `Uploaded clip: ${media.title}`,
                    time: media.date
                });
            });
            
            // Sort by time (most recent first)
            activities.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            // Display recent activities
            const activityTable = document.getElementById('recentActivity');
            if (activityTable) {
                activityTable.innerHTML = '';
                activities.slice(0, 10).forEach(activity => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${activity.user}</td>
                        <td>${activity.action}</td>
                        <td>${activity.time}</td>
                    `;
                    activityTable.appendChild(row);
                });
            }
        }

        // =============================================
        // USER MANAGEMENT
        // =============================================
        function loadUsers() {
            try {
                const users = JSON.parse(localStorage.getItem('cavalight_users') || '[]');
                const userList = document.getElementById('userList');
                
                if (userList) {
                    userList.innerHTML = '';
                    
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.username}</td>
                            <td>${user.email}</td>
                            <td><span class="role-badge ${user.role === 'admin' ? 'role-admin' : user.role === 'team' ? 'role-team' : 'role-community'}">${user.role}</span></td>
                            <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;" onclick="editUser('${user.id}')">Edit</button>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="deleteUser('${user.id}')">Delete</button>
                            </td>
                        `;
                        userList.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function refreshUsers() {
            loadUsers();
            updateDashboardStats();
            alert('Users list refreshed!');
        }

        function editUser(userId) {
            alert('Edit user functionality to be implemented');
        }

        function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) return;
            
            const users = JSON.parse(localStorage.getItem('cavalight_users') || '[]');
            const updatedUsers = users.filter(user => user.id !== userId);
            localStorage.setItem('cavalight_users', JSON.stringify(updatedUsers));
            
            // Also remove from current user if it's the same user
            const currentUser = JSON.parse(localStorage.getItem('cavalight_currentUser') || '{}');
            if (currentUser.id === userId) {
                logoutUser();
            }
            
            loadUsers();
            updateDashboardStats();
            alert('User deleted successfully!');
        }

        // =============================================
        // EVENT MANAGEMENT
        // =============================================
        function loadEvents() {
            try {
                let events = JSON.parse(localStorage.getItem('cavalight_events'));
                
                if (!events || events.length === 0) {
                    events = [
                        {
                            id: 1,
                            title: "Valorant Community Cup #6",
                            description: "Join our monthly community tournament with prizes for top teams!",
                            date: "2023-12-15T18:00",
                            type: "tournament",
                            location: "Discord & Twitch",
                            participants: 32,
                            status: "upcoming",
                            maxParticipants: 64,
                            createdBy: "Admin"
                        },
                        {
                            id: 2,
                            title: "Pro Scrim Session",
                            description: "Professional scrim session with other competitive teams",
                            date: "2023-12-10T20:00",
                            type: "scrim",
                            location: "Valorant Custom Game",
                            participants: 10,
                            status: "upcoming",
                            maxParticipants: 10,
                            createdBy: "Team Manager"
                        },
                        {
                            id: 3,
                            title: "Community Training Day",
                            description: "Learn from our pro players and improve your skills",
                            date: "2023-12-05T19:00",
                            type: "training",
                            location: "Discord Voice",
                            participants: 50,
                            status: "completed",
                            maxParticipants: 100,
                            createdBy: "Community Manager"
                        }
                    ];
                    localStorage.setItem('cavalight_events', JSON.stringify(events));
                }
                
                const eventsTimeline = document.getElementById('eventsTimeline');
                if (!eventsTimeline) return;
                
                eventsTimeline.innerHTML = '';
                
                events.forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.className = 'event-item';
                    eventItem.innerHTML = `
                        <div class="event-date">
                            <i class="fas fa-calendar-alt"></i>
                            ${new Date(event.date).toLocaleDateString()} at ${new Date(event.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                        </div>
                        <h3 class="event-title">${event.title}</h3>
                        <p class="event-description">${event.description}</p>
                        <div class="event-details">
                            <div class="event-detail">
                                <i class="fas fa-gamepad"></i>
                                ${event.type.toUpperCase()}
                            </div>
                            <div class="event-detail">
                                <i class="fas fa-map-marker-alt"></i>
                                ${event.location}
                            </div>
                            <div class="event-detail">
                                <i class="fas fa-users"></i>
                                ${event.participants}/${event.maxParticipants || 'Unlimited'} Participants
                            </div>
                            <div class="event-detail">
                                <i class="fas fa-user"></i>
                                ${event.createdBy}
                            </div>
                        </div>
                        <div class="event-actions">
                            <button class="btn btn-primary" onclick="rsvpToEvent(${event.id})">
                                <i class="fas fa-calendar-plus"></i> RSVP
                            </button>
                            <button class="btn btn-outline" onclick="showEventDetails(${event.id})">
                                <i class="fas fa-info-circle"></i> Details
                            </button>
                            ${checkAdminAccess() ? `
                                <button class="btn btn-warning" onclick="openEditEventModal(${event.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger" onclick="deleteEvent(${event.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            ` : ''}
                        </div>
                    `;
                    
                    eventsTimeline.appendChild(eventItem);
                });
                
            } catch (error) {
                console.error('Error loading events:', error);
            }
        }

        function loadDashboardEvents() {
            try {
                const events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
                const eventList = document.getElementById('eventList');
                
                if (eventList) {
                    eventList.innerHTML = '';
                    
                    events.forEach(event => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${event.title}</td>
                            <td>${new Date(event.date).toLocaleDateString()}</td>
                            <td>${event.type}</td>
                            <td>${event.participants || 0}/${event.maxParticipants || ''}</td>
                            <td><span class="badge ${event.status === 'upcoming' ? 'badge-primary' : event.status === 'completed' ? 'badge-success' : 'badge-warning'}">${event.status || 'upcoming'}</span></td>
                            <td>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;" onclick="openEditEventModal(${event.id})">Edit</button>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="deleteEvent(${event.id})">Delete</button>
                                <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="viewEvent(${event.id})">View</button>
                            </td>
                        `;
                        eventList.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading dashboard events:', error);
            }
        }

        function refreshEvents() {
            loadEvents();
            loadDashboardEvents();
            updateDashboardStats();
            alert('Events refreshed!');
        }

        function createEvent() {
            const title = document.getElementById('eventTitle').value;
            const description = document.getElementById('eventDescription').value;
            const date = document.getElementById('eventDate').value;
            const type = document.getElementById('eventType').value;
            const location = document.getElementById('eventLocation').value;

            if (!title || !description || !date || !type || !location) {
                alert('Please fill in all fields!');
                return;
            }

            try {
                // Get current user
                const currentUser = JSON.parse(localStorage.getItem('cavalight_currentUser'));
                
                if (!currentUser || currentUser.role !== 'admin') {
                    alert('Only administrators can create events.');
                    return;
                }
                
                // Create event object
                const eventData = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    date: date,
                    type: type,
                    location: location,
                    createdBy: currentUser.username || 'Admin',
                    createdById: currentUser.id || 'admin',
                    participants: 0,
                    status: 'upcoming',
                    maxParticipants: 100
                };
                
                // Save to localStorage
                const existingEvents = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
                existingEvents.push(eventData);
                localStorage.setItem('cavalight_events', JSON.stringify(existingEvents));
                
                alert('Event created successfully!');
                closeModal('createEventModal');
                loadEvents();
                loadDashboardEvents();
                updateDashboardStats();
                
            } catch (error) {
                console.error('Event creation error:', error);
                alert('Error creating event: ' + error.message);
            }
        }

        function updateEvent() {
            const eventId = document.getElementById('editEventId').value;
            const title = document.getElementById('editEventTitle').value;
            const description = document.getElementById('editEventDescription').value;
            const date = document.getElementById('editEventDate').value;
            const type = document.getElementById('editEventType').value;
            const location = document.getElementById('editEventLocation').value;
            const participants = document.getElementById('editEventParticipants').value;
            const status = document.getElementById('editEventStatus').value;

            if (!title || !description || !date || !type || !location) {
                alert('Please fill in all required fields!');
                return;
            }

            let events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
            const index = events.findIndex(event => event.id == eventId);

            if (index !== -1) {
                events[index] = { 
                    ...events[index], 
                    title, 
                    description, 
                    date, 
                    type, 
                    location,
                    maxParticipants: parseInt(participants) || events[index].maxParticipants,
                    status
                };
                localStorage.setItem('cavalight_events', JSON.stringify(events));

                alert('Event updated successfully!');
                closeModal('editEventModal');
                loadEvents();
                loadDashboardEvents();
                updateDashboardStats();
            }
        }

        function deleteEvent(eventId) {
            if (!confirm('Are you sure you want to delete this event? This action cannot be undone.')) return;

            let events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
            events = events.filter(event => event.id != eventId);
            localStorage.setItem('cavalight_events', JSON.stringify(events));

            alert('Event deleted successfully!');
            loadEvents();
            loadDashboardEvents();
            updateDashboardStats();
        }

        function deleteCurrentEvent() {
            const eventId = document.getElementById('editEventId').value;
            deleteEvent(eventId);
            closeModal('editEventModal');
        }

        function viewEvent(eventId) {
            const events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
            const event = events.find(e => e.id == eventId);
            
            if (event) {
                alert(`Event Details:\n\nTitle: ${event.title}\nDescription: ${event.description}\nDate: ${new Date(event.date).toLocaleString()}\nType: ${event.type}\nLocation: ${event.location}\nStatus: ${event.status}\nParticipants: ${event.participants}/${event.maxParticipants || 'Unlimited'}`);
            }
        }

        // =============================================
        // MEDIA MANAGEMENT
        // =============================================
        function loadDashboardMedia() {
            try {
                const mediaItems = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
                const mediaList = document.getElementById('mediaList');
                
                if (mediaList) {
                    mediaList.innerHTML = '';
                    
                    mediaItems.forEach(media => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${media.title}</td>
                            <td>${media.category}</td>
                            <td>${media.uploader || 'Unknown'}</td>
                            <td>${media.date}</td>
                            <td>${media.views || 0}</td>
                            <td><span class="badge ${media.status === 'approved' ? 'badge-success' : media.status === 'rejected' ? 'badge-danger' : 'badge-warning'}">${media.status || 'pending'}</span></td>
                            <td>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;" onclick="openEditMediaModal(${media.id})">Edit</button>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="deleteMedia(${media.id})">Delete</button>
                                <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="viewMedia(${media.id})">View</button>
                            </td>
                        `;
                        mediaList.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading dashboard media:', error);
            }
        }

        function refreshMedia() {
            loadMedia();
            loadDashboardMedia();
            updateDashboardStats();
            alert('Media list refreshed!');
        }

        function updateMedia() {
            const mediaId = document.getElementById('editMediaId').value;
            const title = document.getElementById('editMediaTitle').value;
            const description = document.getElementById('editMediaDescription').value;
            const category = document.getElementById('editMediaCategory').value;
            const url = document.getElementById('editMediaUrl').value;
            const thumbnail = document.getElementById('editMediaThumbnail').value;
            const status = document.getElementById('editMediaStatus').value;

            if (!title || !description || !category || !url) {
                alert('Please fill in all required fields!');
                return;
            }

            let mediaItems = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
            const index = mediaItems.findIndex(media => media.id == mediaId);

            if (index !== -1) {
                mediaItems[index] = { 
                    ...mediaItems[index], 
                    title, 
                    description, 
                    category, 
                    url, 
                    thumbnail,
                    status
                };
                localStorage.setItem('cavalight_media', JSON.stringify(mediaItems));

                alert('Media updated successfully!');
                closeModal('editMediaModal');
                loadMedia();
                loadDashboardMedia();
                updateDashboardStats();
            }
        }

        function deleteMedia(mediaId) {
            if (!confirm('Are you sure you want to delete this media? This action cannot be undone.')) return;

            let mediaItems = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
            mediaItems = mediaItems.filter(media => media.id != mediaId);
            localStorage.setItem('cavalight_media', JSON.stringify(mediaItems));

            alert('Media deleted successfully!');
            loadMedia();
            loadDashboardMedia();
            updateDashboardStats();
        }

        function deleteCurrentMedia() {
            const mediaId = document.getElementById('editMediaId').value;
            deleteMedia(mediaId);
            closeModal('editMediaModal');
        }

        function viewMedia(mediaId) {
            const mediaItems = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
            const media = mediaItems.find(m => m.id == mediaId);
            
            if (media) {
                window.open(media.url, '_blank');
            }
        }

        // =============================================
        // NEWS MANAGEMENT
        // =============================================
        function loadDashboardNews() {
            try {
                const newsItems = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
                const newsList = document.getElementById('newsList');
                
                if (newsList) {
                    newsList.innerHTML = '';
                    
                    newsItems.forEach(news => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${news.title}</td>
                            <td>${news.date}</td>
                            <td>${news.author}</td>
                            <td><span class="badge ${news.status === 'published' ? 'badge-success' : news.status === 'draft' ? 'badge-warning' : 'badge-secondary'}">${news.status || 'published'}</span></td>
                            <td>${news.views || 0}</td>
                            <td>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;" onclick="openEditNewsModal(${news.id})">Edit</button>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="deleteNews(${news.id})">Delete</button>
                                <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="viewNews(${news.id})">View</button>
                            </td>
                        `;
                        newsList.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading dashboard news:', error);
            }
        }

        function refreshNews() {
            loadNews();
            loadDashboardNews();
            updateDashboardStats();
            alert('News list refreshed!');
        }

        function updateNews() {
            const newsId = document.getElementById('editNewsId').value;
            const title = document.getElementById('editNewsTitle').value;
            const content = document.getElementById('editNewsContent').value;
            const category = document.getElementById('editNewsCategory').value;
            const image = document.getElementById('editNewsImage').value;
            const status = document.getElementById('editNewsStatus').value;

            if (!title || !content || !category) {
                alert('Please fill in all required fields!');
                return;
            }

            let newsItems = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
            const index = newsItems.findIndex(news => news.id == newsId);

            if (index !== -1) {
                newsItems[index] = { 
                    ...newsItems[index], 
                    title, 
                    content, 
                    category, 
                    image,
                    status
                };
                localStorage.setItem('cavalight_news', JSON.stringify(newsItems));

                alert('News updated successfully!');
                closeModal('editNewsModal');
                loadNews();
                loadDashboardNews();
                updateDashboardStats();
            }
        }

        function deleteNews(newsId) {
            if (!confirm('Are you sure you want to delete this news? This action cannot be undone.')) return;

            let newsItems = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
            newsItems = newsItems.filter(news => news.id != newsId);
            localStorage.setItem('cavalight_news', JSON.stringify(newsItems));

            alert('News deleted successfully!');
            loadNews();
            loadDashboardNews();
            updateDashboardStats();
        }

        function deleteCurrentNews() {
            const newsId = document.getElementById('editNewsId').value;
            deleteNews(newsId);
            closeModal('editNewsModal');
        }

        function viewNews(newsId) {
            const newsItems = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
            const news = newsItems.find(n => n.id == newsId);
            
            if (news) {
                alert(`News Details:\n\nTitle: ${news.title}\n\nContent: ${news.content}\n\nCategory: ${news.category}\n\nAuthor: ${news.author}\n\nDate: ${news.date}`);
            }
        }

        // =============================================
        // HELPER FUNCTIONS
        // =============================================
        function checkAdminAccess() {
            const userRole = localStorage.getItem('cavalight_userRole');
            return userRole === 'admin';
        }

        function checkTeamAccess() {
            const userRole = localStorage.getItem('cavalight_userRole');
            return userRole === 'team' || userRole === 'admin';
        }

        // Team Portal Functions
        function openScrimUploadModal() {
            alert('Scrim upload functionality to be implemented');
        }

        function viewScrimResults() {
            alert('View scrim results functionality to be implemented');
        }

        function openStrategyModal() {
            alert('Strategy upload functionality to be implemented');
        }

        function viewStrategies() {
            alert('View strategies functionality to be implemented');
        }

        function openTrainingModal() {
            alert('Training edit functionality to be implemented');
        }

        function viewTraining() {
            alert('View training schedule functionality to be implemented');
        }

        function viewMatches() {
            alert('View matches functionality to be implemented');
        }

        function addMatch() {
            alert('Add match functionality to be implemented');
        }

        function openTeamChat() {
            // Open Discord server
            window.open('https://discord.gg/Um8VR8yk', '_blank');
        }

        function createTeamPost() {
            alert('Create team post functionality to be implemented');
        }

        function viewTeamPosts() {
            alert('View team posts functionality to be implemented');
        }

        // =============================================
        // EMAILJS CONTACT FORM (UPDATED)
        // =============================================
        function sendEmail() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const subject = document.getElementById('subject').value;
            const message = document.getElementById('message').value;

            if (!name || !email || !subject || !message) {
                alert('Please fill in all fields!');
                return;
            }

            // Prepare template parameters
            const templateParams = {
                from_name: name,
                from_email: email,
                subject: subject,
                message: message,
                to_name: 'CAVALIGHT Team'
            };

            // Send email using EmailJS with updated service and template IDs
            emailjs.send('service_1hbotzt', 'template_3aqjamb', templateParams)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    document.getElementById('form-message').innerHTML = 
                        '<span style="color: #4CAF50;"> Message sent successfully! We\'ll get back to you soon.</span>';
                    document.getElementById('contactForm').reset();
                }, function(error) {
                    console.log('FAILED...', error);
                    document.getElementById('form-message').innerHTML = 
                        '<span style="color: #f44336;"> Failed to send message. Please try again later.</span>';
                });
        }

        // =============================================
        // INITIALIZE ON LOAD
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize counters
            checkCounters();
            
            // Trigger scroll once to activate counters if already in view
            setTimeout(checkCounters, 100);
            
            // Initialize data
            loadInitialData();
            
            // Check if user is logged in
            checkLoggedInUser();
        });

        // Existing functions that remain the same
        function loadInitialData() {
            loadMedia();
            loadEvents();
            loadNews();
        }

        function loadMedia() {
            try {
                let mediaItems = JSON.parse(localStorage.getItem('cavalight_media'));
                
                if (!mediaItems || mediaItems.length === 0) {
                    mediaItems = [
                        {
                            id: 1,
                            title: "A1D's INSANE 1v5 ACE",
                            description: "Watch A1D clutch a 1v5 situation in tournament finals",
                            category: "highlights",
                            url: "https://www.youtube.com/embed/dQw4w9WgXcQ",
                            thumbnail: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80",
                            views: 1250,
                            likes: 89,
                            date: "2023-11-15",
                            uploader: "Admin",
                            status: "approved"
                        }
                    ];
                    localStorage.setItem('cavalight_media', JSON.stringify(mediaItems));
                }
                
                const mediaGrid = document.getElementById('mediaGrid');
                if (!mediaGrid) return;
                
                mediaGrid.innerHTML = '';
                
                mediaItems.forEach(media => {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-item';
                    mediaItem.dataset.category = media.category;
                    mediaItem.innerHTML = `
                        <div class="media-item-header" style="background-image: url('${media.thumbnail}'); background-size: cover; background-position: center;">
                        </div>
                        <div class="media-item-content">
                            <h3 class="media-item-title">${media.title}</h3>
                            <p class="media-item-description">${media.description}</p>
                            <div class="media-item-meta">
                                <span><i class="fas fa-eye"></i> ${media.views} views</span>
                                <span><i class="fas fa-heart"></i> ${media.likes} likes</span>
                                <span><i class="fas fa-calendar"></i> ${media.date}</span>
                                <span><i class="fas fa-user"></i> ${media.uploader}</span>
                            </div>
                            <div class="media-item-actions">
                                <button class="btn btn-outline" style="padding: 8px 16px; font-size: 0.9rem;" onclick="window.open('${media.url}', '_blank')">
                                    <i class="fas fa-play"></i> Watch
                                </button>
                                <button class="btn btn-primary" style="padding: 8px 16px; font-size: 0.9rem;" onclick="shareMedia('${media.title}', '${media.url}')">
                                    <i class="fas fa-share"></i> Share
                                </button>
                            </div>
                        </div>
                    `;
                    
                    mediaGrid.appendChild(mediaItem);
                });
                
            } catch (error) {
                console.error('Error loading media:', error);
            }
        }

        function shareMedia(title, url) {
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        }

        function rsvpToEvent(eventId) {
            const user = JSON.parse(localStorage.getItem('cavalight_currentUser'));
            if (!user) {
                alert('Please login to RSVP to events.');
                openModal('loginModal');
                return;
            }
            
            let rsvps = JSON.parse(localStorage.getItem('cavalight_rsvps') || '{}');
            
            if (rsvps[eventId]) {
                if (rsvps[eventId].includes(user.id)) {
                    alert('You have already RSVPed to this event.');
                    return;
                }
                rsvps[eventId].push(user.id);
            } else {
                rsvps[eventId] = [user.id];
            }
            
            localStorage.setItem('cavalight_rsvps', JSON.stringify(rsvps));
            alert('Successfully RSVPed to the event!');
        }

        function showEventDetails(eventId) {
            const events = JSON.parse(localStorage.getItem('cavalight_events') || '[]');
            const event = events.find(e => e.id == eventId);
            
            if (event) {
                alert(`Event Details:\n\nTitle: ${event.title}\nDescription: ${event.description}\nDate: ${new Date(event.date).toLocaleString()}\nType: ${event.type}\nLocation: ${event.location}\nParticipants: ${event.participants}/${event.maxParticipants || 'Unlimited'}`);
            }
        }

        function loadNews() {
            try {
                let newsItems = JSON.parse(localStorage.getItem('cavalight_news'));
                
                if (!newsItems || newsItems.length === 0) {
                    newsItems = [
                        {
                            id: 1,
                            title: "CAVALIGHT Wins Regional Championship",
                            content: "Our team dominated the regional finals, securing first place and qualifying for nationals.",
                            category: "tournament",
                            image: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80",
                            date: "2023-11-20",
                            author: "Admin",
                            status: "published",
                            views: 1250
                        }
                    ];
                    localStorage.setItem('cavalight_news', JSON.stringify(newsItems));
                }
                
                const newsGrid = document.getElementById('newsGrid');
                if (!newsGrid) return;
                
                newsGrid.innerHTML = '';
                
                newsItems.forEach(news => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'news-item';
                    newsItem.innerHTML = `
                        <div class="news-item-header" style="background-image: url('${news.image}'); background-size: cover; background-position: center;">
                            <div style="position: relative; z-index: 2; text-align: center;">
                                <div style="background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 10px;">
                                    <i class="fas fa-newspaper" style="font-size: 3rem; margin-bottom: 10px;"></i>
                                    <div style="text-transform: uppercase; letter-spacing: 2px;">${news.category}</div>
                                </div>
                            </div>
                        </div>
                        <div class="news-item-content">
                            <div class="news-item-date">
                                <i class="fas fa-calendar"></i>
                                ${news.date}
                            </div>
                            <h3 class="news-item-title">${news.title}</h3>
                            <p class="news-item-excerpt">${news.content.substring(0, 100)}...</p>
                            <button class="btn btn-outline" style="width: 100%;" onclick="readMoreNews(${news.id})">
                                <i class="fas fa-book-open"></i> Read More
                            </button>
                        </div>
                    `;
                    
                    newsGrid.appendChild(newsItem);
                });
                
            } catch (error) {
                console.error('Error loading news:', error);
            }
        }

        function readMoreNews(newsId) {
            const newsItems = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
            const news = newsItems.find(item => item.id === newsId);
            
            if (news) {
                alert(` ${news.title}\n\n${news.content}\n\n- ${news.author}, ${news.date}`);
            }
        }

        function filterMedia(category) {
            const tabs = document.querySelectorAll('.media-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const clickedTab = event.target;
            clickedTab.classList.add('active');
            
            const mediaItems = document.querySelectorAll('.media-item');
            mediaItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function uploadMedia() {
            const title = document.getElementById('mediaTitle').value;
            const description = document.getElementById('mediaDescription').value;
            const category = document.getElementById('mediaCategory').value;
            const url = document.getElementById('mediaUrl').value;
            const thumbnail = document.getElementById('mediaThumbnail').value;

            if (!title || !description || !category || !url) {
                alert('Please fill in all required fields!');
                return;
            }

            try {
                const currentUser = JSON.parse(localStorage.getItem('cavalight_currentUser'));
                
                if (!currentUser) {
                    alert('Please login to upload media.');
                    openModal('loginModal');
                    return;
                }
                
                const mediaData = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    category: category,
                    url: url,
                    thumbnail: thumbnail || 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
                    uploader: currentUser.username || 'Anonymous',
                    uploaderId: currentUser.id || 'anonymous',
                    date: new Date().toISOString().split('T')[0],
                    views: 0,
                    likes: 0,
                    status: 'pending'
                };
                
                const existingMedia = JSON.parse(localStorage.getItem('cavalight_media') || '[]');
                existingMedia.push(mediaData);
                localStorage.setItem('cavalight_media', JSON.stringify(existingMedia));
                
                alert('Clip uploaded successfully! It will be reviewed by an admin.');
                closeModal('uploadMediaModal');
                loadMedia();
                loadDashboardMedia();
                
            } catch (error) {
                console.error('Upload error:', error);
                alert('Error uploading clip: ' + error.message);
            }
        }

        function createNews() {
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            const category = document.getElementById('newsCategory').value;
            const image = document.getElementById('newsImage').value;

            if (!title || !content || !category) {
                alert('Please fill in all required fields!');
                return;
            }

            try {
                const currentUser = JSON.parse(localStorage.getItem('cavalight_currentUser'));
                
                if (!currentUser || currentUser.role !== 'admin') {
                    alert('Only administrators can create news posts.');
                    return;
                }
                
                const newsData = {
                    id: Date.now(),
                    title: title,
                    content: content,
                    category: category,
                    image: image || 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
                    author: currentUser.username || 'Admin',
                    authorId: currentUser.id || 'admin',
                    date: new Date().toISOString().split('T')[0],
                    status: 'published',
                    views: 0
                };
                
                const existingNews = JSON.parse(localStorage.getItem('cavalight_news') || '[]');
                existingNews.push(newsData);
                localStorage.setItem('cavalight_news', JSON.stringify(existingNews));
                
                alert('News published successfully!');
                closeModal('createNewsModal');
                loadNews();
                loadDashboardNews();
                
            } catch (error) {
                console.error('News creation error:', error);
                alert('Error publishing news: ' + error.message);
            }
        }
    </script>
</body>
</html>
